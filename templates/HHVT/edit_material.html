{% extends 'UI/base.html' %}

{% block title %}QUẢN LÝ VẬT TƯ{% endblock %}

{% block content %}
    <h1>Sửa Vật tư: {{ material.material_name }}</h1>

    <form action="/update_material" method="POST" class="card card-body bg-light mb-4">
        <input type="hidden" name="material_id" value="{{ material.material_id }}">
        <div class="mb-3">
            <label class="form-label">Tên Vật tư:</label><br>
            <input type="text" name="material_name" class="form-control" value="{{ material.material_name }}" required>
        </div>
		<div class="mb-3">
			<label for="material_type" class="form-label">Loại Vật tư:</label>
			<select id="material_type" name="material_type" class="form-select" onchange="toggleLifespanField()">
				<option value="production" {% if material.material_type == 'production' %}selected{% endif %}>
					Vật tư Sản xuất (để bán)
				</option>
				<option value="maintenance" {% if material.material_type == 'maintenance' %}selected{% endif %}>
					Linh kiện Bảo trì (nội bộ)
				</option>
			</select>
		</div>
		<div class="mb-3" id="lifespan_field_wrapper" style="display: none;">
			<label for="lifespan_prints" class="form-label">Vòng đời (Số bản in/photo):</label>
			<input type="number" id="lifespan_prints" name="lifespan_prints" class="form-control" value="{{ material.lifespan_prints or 0 }}">
		</div>
        <div class="mb-3">
            <label class="form-label">Đơn vị cơ sở (để trừ kho):</label><br>
            <input type="text" name="base_unit" class="form-control" value="{{ material.base_unit }}" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Đơn vị nhập (để mua hàng):</label><br>
            <input type="text" name="import_unit" class="form-control" value="{{ material.import_unit }}">
        </div>
        <div class="mb-3">
            <label class="form-label">Hệ số quy đổi (1 ĐV Nhập = ? ĐV Cơ sở):</label><br>
            <input type="number" step="0.01" name="import_conversion_factor" class="form-control" value="{{ material.import_conversion_factor }}" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Số lượng tồn kho (tính theo ĐV Cơ sở):</label><br>
            <input type="number" name="stock_quantity" class="form-control" value="{{ material.stock_quantity }}">
        </div>
        
		<button type="submit" class="btn btn-primary">Cập nhật Vật tư</button>
    </form>
    <a href="{{ url_for('materials_page') }}" class="btn btn-sm btn-warning">&larr; Quay lại danh sách</a>
	
	<script>
		function toggleLifespanField() {
			var select = document.getElementById('material_type');
			var wrapper = document.getElementById('lifespan_field_wrapper');
			var input = document.getElementById('lifespan_prints');
			
			if (select.value === 'maintenance') {
				wrapper.style.display = 'block';
			} else {
				wrapper.style.display = 'none';
				// Không reset giá trị khi sửa, để người dùng tự quyết
			}
		}
		// Chạy 1 lần khi tải trang
		document.addEventListener('DOMContentLoaded', toggleLifespanField);
	</script>
{% endblock %}