{% extends 'UI/base.html' %}

{% block title %}QUáº¢N LÃ Váº¬T TÆ¯{% endblock %}

{% block content %}

    <h1>Trang Quáº£n LÃ½ Váº­t TÆ°</h1>

    <h2>ThÃªm Váº­t TÆ° Má»›i</h2>
    <form action="/add_material" method="POST" class="card card-body bg-light mb-4">
        <div class="mb-3">
            <label class="form-label">TÃªn Váº­t tÆ°:</label><br>
            <input type="text" name="material_name" class="form-control" required>
        </div>
		<div class="mb-3">
			<label for="material_type" class="form-label">Loáº¡i Váº­t tÆ°:</label>
			<select id="material_type" name="material_type" class="form-select" onchange="toggleLifespanField()">
				<option value="production">Váº­t tÆ° Sáº£n xuáº¥t (Ä‘á»ƒ bÃ¡n)</option>
				<option value="maintenance">Linh kiá»‡n Báº£o trÃ¬ (ná»™i bá»™)</option>
			</select>
		</div>
		<div class="mb-3" id="lifespan_field_wrapper" style="display: none;">
			<label for="lifespan_prints" class="form-label">VÃ²ng Ä‘á»i (Sá»‘ báº£n in/photo):</label>
			<input type="number" id="lifespan_prints" name="lifespan_prints" class="form-control" value="0">
		</div>
        <div class="mb-3">
            <label class="form-label">ÄÆ¡n vá»‹ cÆ¡ sá»Ÿ (Ä‘á»ƒ trá»« kho):</label><br>
            <input type="text" name="base_unit" placeholder="VÃ­ dá»¥: tá», ml, gram" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">ÄÆ¡n vá»‹ nháº­p (Ä‘á»ƒ mua hÃ ng):</label><br>
            <input type="text" name="import_unit" class="form-control" placeholder="VÃ­ dá»¥: ram, há»™p, cuá»™n">
        </div>
        <div class="mb-3">
            <label class="form-label">Há»‡ sá»‘ quy Ä‘á»•i (1 ÄV Nháº­p = ? ÄV CÆ¡ sá»Ÿ):</label><br>
            <input type="number" step="0.01" name="import_conversion_factor" value="1" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Tá»“n kho ban Ä‘áº§u (tÃ­nh theo ÄV CÆ¡ sá»Ÿ):</label><br>
            <input type="number" name="stock_quantity" value="0" class="form-control">
        </div>
        
		<button type="submit" class="btn btn-primary">LÆ°u Váº­t tÆ°</button>
    </form>

    <h2>Danh sÃ¡ch Váº­t tÆ°</h2>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ID</th>
                <th>TÃªn Váº­t tÆ°</th>
				<th>Loáº¡i Váº­t tÆ°</th>
                <th>ÄV CÆ¡ sá»Ÿ (Kho)</th>
                <th>ÄV Nháº­p (Mua)</th>
                <th>Há»‡ sá»‘</th>
                <th>Tá»“n kho (theo ÄV CÆ¡ sá»Ÿ)</th>
				<th>VÃ²ng Ä‘á»i (báº£n in)</th>
                <th>HÃ nh Ä‘á»™ng</th>
            </tr>
        </thead>
        <tbody>
            {% for material in materials_list %}
            <tr class="{% if not material.is_active %}table-secondary text-muted{% endif %}">
                <td>{{ material.material_id }}</td>
                <td class="fw-bold">
                    {{ material.material_name }}
                    {% if not material.is_active %}(ÄÃ£ khÃ³a){% endif %}
                </td>
				<td>{{ material.material_type }}</td>
                <td>{{ material.base_unit }}</td>
                <td>{{ material.import_unit }}</td>
                <td>{{ material.import_conversion_factor }}</td>
                <td>{{ material.stock_quantity }}</td>
				<td>{{ material.lifespan_prints or 'N/A' }}</td>
				<td>
                    {% if material.is_active %}
                        <a href="/edit_material/{{ material.material_id }}" class="btn btn-sm btn-warning">Sá»­a</a>
                    {% endif %}

                    <form action="{{ url_for('toggle_material', id=material.material_id) }}" method="POST" style="display:inline;">
                        {% if material.is_active %}
                            <button type="submit" class="btn btn-sm btn-danger" 
                                    onclick="return confirm('KhÃ³a váº­t tÆ° nÃ y? NÃ³ sáº½ áº©n khá»i trang khÃ¡c.');">
                                ğŸ”’ KhÃ³a
                            </button>
                        {% else %}
                            <button type="submit" class="btn btn-sm btn-success">
                                ğŸ”“ Má»Ÿ láº¡i
                            </button>
                        {% endif %}
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
	
	<script>
		function toggleLifespanField() {
			var select = document.getElementById('material_type');
			var wrapper = document.getElementById('lifespan_field_wrapper');
			var input = document.getElementById('lifespan_prints');
			
			if (select.value === 'maintenance') {
				wrapper.style.display = 'block'; // Hiá»‡n ra
			} else {
				wrapper.style.display = 'none'; // áº¨n Ä‘i
				input.value = 0; // Reset
			}
		}
		// Cháº¡y 1 láº§n khi táº£i trang (trong trÆ°á»ng há»£p edit)
		document.addEventListener('DOMContentLoaded', toggleLifespanField);
	</script>

{% endblock %}