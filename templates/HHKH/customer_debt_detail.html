{% extends 'UI/base.html' %}

{% block title %}Chi tiết Công nợ: {{ customer_info.customer_name }}{% endblock %}

{% block content %}
    <h1 class="mb-4">Chi tiết Công nợ: {{ customer_info.customer_name }}</h1>
    <a href="{{ url_for('customer_debt_report') }}">&larr; Quay lại Báo cáo Tổng hợp</a>

    <div class="alert alert-danger mt-3">
        <h4>Tổng Công nợ Phải Thu từ {{ customer_info.customer_name }}</h4>
        <p>
            <strong>Điện thoại:</strong> {{ customer_info.phone }} <br>
            <strong>Công ty:</strong> {{ customer_info.company_name or 'N/A' }} <br>
            <strong>Mã số thuế:</strong> {{ customer_info.tax_id or 'N/A' }}
        </p>
        <hr>
        <h2 class="mb-0">{{ total_due|currency }} vnđ</h2>
    </div>

    <h3>Các Đơn hàng Chưa thanh toán đủ</h3>
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Mã Đơn hàng</th>
                <th>Ngày đặt</th>
                <th>Tổng tiền</th>
                <th>Đã trả</th>
                <th>Số tiền còn nợ</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            {% if unpaid_orders_list %}
                {% for order in unpaid_orders_list %}
                <tr>
                    <td>#{{ order.order_id }}</td>
                    <td>{{ order.order_date }}</td>
                    <td>{{ order.total_amount|currency }} vnđ</td>
                    <td>{{ order.amount_paid|currency }} vnđ</td>
                    <td class="fw-bold text-danger">{{ order.amount_due|currency }} vnđ</td>
                    <td>
                        <a href="{{ url_for('order_detail_page', order_id=order.order_id) }}" class="btn btn-sm btn-primary">
                            Xem & Thanh toán
                        </a>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" class="text-center">Khách hàng này không nợ tiền.</td>
                </tr>
            {% endif %}
        </tbody>
    </table>

{% endblock %}