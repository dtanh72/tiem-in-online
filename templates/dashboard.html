{% extends 'UI/base.html' %}

{% block title %}B·∫£ng ƒëi·ªÅu khi·ªÉn{% endblock %}

{% block content %}
    <h1 class="mb-4">B·∫£ng ƒëi·ªÅu khi·ªÉn (Real-time)</h1>

    <div class="row">
        <div class="col-lg-3 col-md-6 mb-4"> <div class="card text-white bg-success h-100">
                <div class="card-header">DOANH THU TH·ª∞C T·∫æ</div>
                <div class="card-body">
                    <h4 class="card-title">{{ revenue_today|currency }} vnƒë</h4>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-white bg-secondary h-100">
                <div class="card-header">DOANH THU B·ªä H·ª¶Y</div>
                <div class="card-body">
                    <h4 class="card-title">{{ revenue_cancelled_today|currency }} vnƒë</h4>
                    <p class="card-text small">ƒê∆°n h√†ng b·ªã h·ªßy h√¥m nay</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-white bg-danger h-100">
                <div class="card-header">C√îNG N·ª¢ PH·∫¢I THU (Kh√°ch n·ª£)</div>
                <div class="card-body">
                    <h4 class="card-title">{{ total_due_customer|currency }} vnƒë</h4>
                </div>
                <div class="card-footer d-flex justify-content-between">
                    <a href="{{ url_for('customer_debt_report') }}" class="small text-white text-decoration-none">Xem chi ti·∫øt &rarr;</a>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-dark bg-warning h-100">
                <div class="card-header">C√îNG N·ª¢ PH·∫¢I TR·∫¢ (M√¨nh n·ª£)</div>
                <div class="card-body">
                    <h4 class="card-title">{{ total_due_supplier|currency }} vnƒë</h4>
                </div>
                <div class="card-footer d-flex justify-content-between">
                    <a href="{{ url_for('supplier_debt_report') }}" class="small text-dark text-decoration-none">Xem chi ti·∫øt &rarr;</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card text-white bg-primary h-100">
                <div class="card-header">ƒê∆†N H√ÄNG M·ªöI (H√¥m nay)</div>
                <div class="card-body">
                    <h4 class="card-title">{{ orders_today }}</h4>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card text-dark bg-info h-100">
                <div class="card-header">B√ÅO GI√Å ƒêANG CH·ªú</div>
                <div class="card-body">
                    <h4 class="card-title">{{ pending_quotes }}</h4>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card text-white bg-secondary h-100">
                <div class="card-header">ƒê∆†N H√ÄNG CH·ªú GIAO</div>
                <div class="card-body">
                    <h4 class="card-title">{{ pending_delivery }}</h4>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <h2>C·∫£nh b√°o V·∫≠t t∆∞ S·∫Øp h·∫øt</h2>
            <p>C√°c v·∫≠t t∆∞ c√≥ t·ªìn kho d∆∞·ªõi 500 (t√≠nh theo ƒë∆°n v·ªã c∆° s·ªü).</p>
            
            <table class="table table-sm table-hover table-bordered">
                <thead class="table-danger">
                    <tr>
                        <th>T√™n V·∫≠t t∆∞</th>
                        <th>T·ªìn kho (ƒêV C∆° s·ªü)</th>
                        <th>ƒê∆°n v·ªã C∆° s·ªü</th>
                    </tr>
                </thead>
                <tbody>
                    {% if low_stock_items %}
                        {% for item in low_stock_items %}
                        <tr>
                            <td>{{ item.material_name }}</td>
                            <td><strong>{{ item.stock_quantity }}</strong></td>
                            <td>{{ item.base_unit }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="3" class="text-center">T·ªët! Kh√¥ng c√≥ v·∫≠t t∆∞ n√†o s·∫Øp h·∫øt.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>	
	
	<div class="col-md-12">
		<h2>üõ†Ô∏è Theo d√µi Tu·ªïi th·ªç Linh ki·ªán</h2> <p>Danh s√°ch t·∫•t c·∫£ linh ki·ªán ƒëang ƒë∆∞·ª£c theo d√µi tr√™n c√°c m√°y.</p>
		
		<table class="table table-bordered table-hover">
			<thead class="table-light">
				<tr>
					<th>Thi·∫øt b·ªã</th>
					<th>Linh ki·ªán</th>
					<th>V√≤ng ƒë·ªùi (A)</th>
					<th>Thay l√∫c (B)</th>
					<th>H·∫°n thay (A+B)</th>
					<th>Counter M√°y (C)</th>
					<th>C√≤n l·∫°i (A+B-C)</th>
				</tr>
			</thead>
			<tbody>
				{% if maintenance_alerts %}
					{% for alert in maintenance_alerts %}
					<tr>
						<td>{{ alert.equipment_name }}</td>
						<td>{{ alert.material_name }}</td>
						<td>{{ alert.lifespan_prints|currency }}</td>
						<td>{{ alert.last_replaced_at|currency }}</td>
						
						<td class="fw-bold">{{ alert.next_due_at|currency }}</td>
						
						<td style="color: blue;">{{ alert.current_machine_counter|currency }}</td>
						
						{% if alert.remaining_prints <= 0 %}
							<td class="bg-danger text-white fw-bold">
								{{ alert.remaining_prints|currency }} (N√äN THAY)
							</td>
						{% elif alert.remaining_prints < 5000 %}
							<td class="bg-warning text-dark fw-bold">
								{{ alert.remaining_prints|currency }} (S·∫Øp thay)
							</td>
						{% else %}
							<td class="text-success">
								{{ alert.remaining_prints|currency }} (T·ªët)
							</td>
						{% endif %}
					</tr>
					{% endfor %}
				{% else %}
					<tr>
						<td colspan="7" class="text-center">
							Ch∆∞a c√≥ d·ªØ li·ªáu theo d√µi. 
							<br>H√£y ch·∫Øc ch·∫Øn b·∫°n ƒë√£: 
							1. S·ª≠a v·∫≠t t∆∞ -> Nh·∫≠p "V√≤ng ƒë·ªùi" (>0). 
							2. Th√™m Nh·∫≠t k√Ω b·∫£o tr√¨ -> Ch·ªçn "Linh ki·ªán ƒë√£ thay".
						</td>
					</tr>
				{% endif %}
			</tbody>
		</table>
	</div>
	
	<div class="row mt-4">
        <div class="col-md-12">
            <div class="card border-secondary mb-3">
                <div class="card-header bg-secondary text-white">
                    üìã B√ÅO GI√Å ƒê√É T·ª∞ ƒê·ªòNG H·ª¶Y (Qu√° h·∫°n 7 ng√†y)
                </div>
                <div class="card-body">
                    <table class="table table-sm table-hover">
                        <thead>
                            <tr>
                                <th>M√£ BG</th>
                                <th>Ng√†y t·∫°o</th>
                                <th>Kh√°ch h√†ng</th>
                                <th>T·ªïng ti·ªÅn</th>
                                <th>H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if expired_quotes_list %}
                                {% for quote in expired_quotes_list %}
                                <tr>
                                    <td>#{{ quote.quote_id }}</td>
                                    <td>{{ quote.created_date }}</td>
                                    <td>{{ quote.customer_name }}</td>
                                    <td>{{ quote.total_amount|currency }}</td>
                                    <td>
                                        <a href="{{ url_for('quote_detail_page', quote_id=quote.quote_id) }}" class="btn btn-sm btn-secondary">Xem l·∫°i</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted">Kh√¥ng c√≥ b√°o gi√° n√†o b·ªã h·ªßy t·ª± ƒë·ªông g·∫ßn ƒë√¢y.</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

{% endblock %}